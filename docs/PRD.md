# PRD（Product Requirements Document）
# アイドル情報API

## 📋 プロダクト概要

### ビジョン
アイドルに関連するプロジェクトを構築する開発者のための、**信頼できる汎用的なアイドル情報データソースAPI**を提供する。

### ミッション
- アイドルとグループの基本プロフィール情報を一元管理
- 他のアイドル関連プロジェクトの基盤として機能
- データ品質と整合性を重視した情報提供

---

## 🎯 ターゲットユーザー

### プライマリユーザー
**アイドル関連プロジェクトの開発者**
- アイドル情報を必要とするアプリ・サービスの開発者
- ファン向けアプリ、データ分析ツール、ニュースアグリゲーター等の作成者

### セカンダリユーザー
**データ提供者（Phase 2以降）**
- アイドル情報の登録・更新を申請する一般ユーザー
- 信頼できる情報源からデータを提供する貢献者

---

## ✨ 主要機能

### Phase 1: MVP（管理者のみ運用）

#### 1. アイドル情報管理
- **基本プロフィール**: 名前、よみがな、生年月日、出身地
- **身体情報**: 身長、血液型
- **活動情報**: デビュー日、卒業日、活動状態
- **所属グループ**: 複数グループ対応、役割、期生
- **外部リンク**: 公式URL、SNSアカウント

#### 2. グループ情報管理
- **基本情報**: グループ名、よみがな、結成日、解散日
- **所属情報**: 事務所、レーベル
- **メンバー管理**: グループのメンバー一覧取得

#### 3. 検索・フィルタリング
- 名前での部分一致検索
- グループでのフィルタリング
- 活動状態（現役/卒業）での絞り込み
- 年齢範囲、血液型でのフィルタリング
- ソート機能（名前順、デビュー日順等）
- ページネーション対応

#### 4. セキュリティ
- 読み取りAPI: 公開（認証不要）
- 書き込みAPI: API Key認証必須
- レート制限実装

### Phase 2: 申請・承認フロー

#### 5. データ申請システム
- 誰でもデータ追加・変更を申請可能（認証不要）
- 管理者による承認・却下機能
- 申請理由と情報源の記録

#### 6. スパム対策
- レート制限強化（10申請/日）
- Email検証（オプション）
- 不適切コンテンツフィルタリング

### Phase 3: ユーザー管理

#### 7. JWT認証システム
- ユーザー登録・ログイン
- Role-Based Access Control（RBAC）
  - Admin: すべての操作
  - Trusted Editor: 直接編集可能
  - Viewer: 読み取りのみ

#### 8. 権限管理
- 信頼できるユーザーへの編集権限付与
- 監査ログによる操作履歴管理

---

## 🔧 技術仕様

### 技術スタック
- **言語**: Go 1.24.4
- **Webフレームワーク**: Gin
- **データベース**: MongoDB v2
- **認証**: API Key（Phase 1-2）, JWT（Phase 3）
- **インフラ**: Docker, Docker Compose

### アーキテクチャ
- **パターン**: レイヤードアーキテクチャ（Clean Architecture）
- **レイヤー構成**:
  - Presentation Layer（Handler）
  - Application Layer（Service）
  - Domain Layer（Model, Repository Interface）
  - Infrastructure Layer（Repository Implementation）

### API設計
- **RESTful API**: `/api/v1/`
- **エンドポイント例**:
  - `GET /api/v1/idols` - アイドル一覧取得
  - `POST /api/v1/idols` - アイドル登録（認証必須）
  - `GET /api/v1/groups/:id/members` - グループメンバー一覧

### データモデル
- **Idol**: アイドル情報（複数グループ所属対応）
- **Group**: グループ情報
- **Submission**: 申請情報（Phase 2）
- **Admin**: 管理者情報（Phase 3）

---

## 📊 成功指標（KPI）

### Phase 1
- [ ] API稼働率 ≥ 99%
- [ ] レスポンスタイム ≤ 200ms（平均）
- [ ] アイドル登録数 ≥ 100件
- [ ] グループ登録数 ≥ 20件

### Phase 2
- [ ] 申請数 ≥ 10件/週
- [ ] 申請承認率 ≥ 70%
- [ ] 申請処理時間 ≤ 24時間

### Phase 3
- [ ] 登録ユーザー数 ≥ 10名
- [ ] Trusted Editorユーザー ≥ 3名
- [ ] 月間API呼び出し数 ≥ 10,000回

---

## 🗓️ スケジュール

| フェーズ | 期間 | 主要機能 |
|---------|------|---------|
| Phase 1 (MVP) | 4-6週間 | Idol/Group CRUD, API Key認証 |
| Phase 2 | 3-4週間 | 申請・承認フロー |
| Phase 3 | 4-5週間 | JWT認証, RBAC |

**合計開発期間**: 11-15週間

---

## 🚧 制約条件

### スコープ外
- ❌ ユーザー向けUIの提供（APIのみ）
- ❌ 画像ホスティング（画像URLのみ管理）
- ❌ イベント・スケジュール管理
- ❌ ファン活動記録機能
- ❌ SNS連携機能

### 技術的制約
- MongoDB Atlas使用（初期段階）
- Go標準ライブラリとGinエコシステムの範囲内
- 簡易レート制限（Phase 1、Phase 2以降でRedis検討）

---

## 🔒 セキュリティ要件

### 必須対応
- [ ] HTTPS通信（本番環境）
- [ ] API Key環境変数管理
- [ ] 入力バリデーション（XSS, SQLインジェクション対策）
- [ ] レート制限実装
- [ ] CORS設定
- [ ] エラーメッセージからの情報漏洩防止

### Phase 2以降
- [ ] reCAPTCHA統合
- [ ] スパムフィルタリング
- [ ] パスワードハッシュ化（bcrypt）
- [ ] JWT有効期限管理
- [ ] 監査ログ

---

## 📚 ドキュメント構成

### 設計ドキュメント
- `docs/data-model.md` - データモデル設計
- `docs/api-specification.md` - API仕様書
- `docs/architecture.md` - アーキテクチャ設計
- `docs/security-design.md` - セキュリティ設計
- `docs/implementation-roadmap.md` - 実装ロードマップ

### 開発者向け
- `CLAUDE.md` - Claude Code向けガイド
- `README.md` - プロジェクト概要と使い方

---

## 🎓 学習リソース

### 必須学習
- MongoDB Go Driver v2
- Gin Webフレームワーク
- Clean Architecture in Go
- JWT認証（Phase 3）

### 推奨学習
- Go Testing
- Docker/Docker Compose
- API設計ベストプラクティス
- セキュリティベストプラクティス

---

## 🔄 将来の拡張性

### 想定される機能追加
- Elasticsearch導入（全文検索高速化）
- 画像アップロード・管理機能
- 統計・分析API
- Webhook通知機能
- GraphQL対応
- OpenAPI/Swagger自動生成

### インフラ拡張
- CDN統合
- Redis（キャッシュ、レート制限）
- Prometheus + Grafana（監視）
- CI/CDパイプライン

---

## ✅ 完了の定義（Definition of Done）

### Phase 1
- [ ] すべてのCRUD API動作確認
- [ ] API Key認証実装
- [ ] 入力バリデーション実装
- [ ] レート制限実装
- [ ] エラーハンドリング実装
- [ ] 基本的なテスト実装
- [ ] Postmanコレクション作成
- [ ] ドキュメント完成

### Phase 2
- [ ] 申請API動作確認
- [ ] 承認・却下フロー動作確認
- [ ] スパム対策実装
- [ ] テスト実装
- [ ] ドキュメント更新

### Phase 3
- [ ] JWT認証動作確認
- [ ] RBAC実装
- [ ] ユーザー管理API動作確認
- [ ] セキュリティテスト完了
- [ ] 本番環境デプロイ準備完了
- [ ] ドキュメント完成

---

## 📞 サポート

### 質問・相談
- プロジェクト管理者に連絡
- GitHub Issuesで課題報告

### 貢献方法（Phase 2以降）
- データ申請APIを通じた情報提供
- バグレポート
- ドキュメント改善提案
